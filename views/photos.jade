extends layout

block content
	script.
		$(function() {
			$('#photo_upload_input').on('change', function(){

				var files = $(this).get(0).files;

				if (files.length > 0){
					// One or more files selected, process the file upload

					// create a FormData object which will be sent as the data payload in the
					// AJAX request
					var formData = new FormData();

					// loop through all the selected files
					for (var i = 0; i < files.length; i++) {
						var file = files[i];

						// add the files to formData object for the data payload
						formData.append('uploads[]', file, file.name);
					}

					console.log(formData);

					$.ajax({
						url: '/photos',
						type: 'POST',
						data: formData,
						processData: false,
						contentType: false,
						success: function(data){
							console.log('upload successful!');
						},
						xhr: function() {
							// create an XMLHttpRequest
							var xhr = new XMLHttpRequest();

							// listen to the 'progress' event
							xhr.upload.addEventListener('progress', function(evt) {

								if (evt.lengthComputable) {
									// calculate the percentage of upload completed
									var percentComplete = evt.loaded / evt.total;
									percentComplete = parseInt(percentComplete * 100);

									// update the Bootstrap progress bar with the new percentage
									$('.progress-bar').text(percentComplete + '%');
									$('.progress-bar').width(percentComplete + '%');

									// once the upload reaches 100%, set the progress bar text to done
									if (percentComplete === 100) {
										$('.progress-bar').html('Done');
									}

								}

							}, false);

							return xhr;
						}
					});
				}
			});
		});

	.container
		.row
			.col-xs-12
				.panel.panel-default
					.panel-body
						span.glyphicon.glyphicon-cloud-upload
						h2 File Uploader
						.progress
							.progress-bar(role="progressbar")
						button.btn.btn-lg.upload-btn(type="button") Upload File

	input#photo_upload_input(type="file", name="uploads[]" multiple="multiple")		


	each photo in photos
		img(src="https://res.cloudinary.com/hf7ourhvw/image/upload/#{photo.cloudinary_public_id}", height="200")
	